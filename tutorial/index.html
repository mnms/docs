
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Lightning DB is a DRAM / SSD optimized real-time in-memory DBMS.">
      
      
        <meta name="author" content="Lightning DB Team">
      
      
        <link rel="canonical" href="https://mnms.github.io/docs/tutorial/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>Tutorial - Lightning DB Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-about-lightning-db" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Lightning DB Docs" class="md-header__button md-logo" aria-label="Lightning DB Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lightning DB Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tutorial
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/mnms/docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    source repository
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Lightning DB Docs" class="md-nav__button md-logo" aria-label="Lightning DB Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Lightning DB Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mnms/docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    source repository
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" tabindex="0" aria-expanded="false">
          Introduction
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Introduction" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Introduction
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../release-note/" class="md-nav__link">
        Release Notes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../awards-recognition/" class="md-nav__link">
        Awards and Recognition
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" tabindex="0" aria-expanded="false">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../prerequisite/" class="md-nav__link">
        Prerequisite
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install-ltcli/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data-ingestion-and-querying/" class="md-nav__link">
        Data Ingestion and querying
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="false">
          Tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorial" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorial
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../try-with-zeppelin/" class="md-nav__link">
        Try out with Zeppelin
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="false">
          Command Line Interface
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Command Line Interface" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Command Line Interface
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli-version/" class="md-nav__link">
        Version
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli-conf/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli-cli/" class="md-nav__link">
        Redis3 cli (LightningDB v1.x)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli-cli2/" class="md-nav__link">
        Redis5 cli (LightningDB v2.x)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli-cluster/" class="md-nav__link">
        Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cli-thriftserver/" class="md-nav__link">
        Thriftserver
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" tabindex="0" aria-expanded="false">
          Ecosystem
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Ecosystem" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Ecosystem
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kaetlyn/" class="md-nav__link">
        Data ingestion with KAFKA
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      
      
        <label class="md-nav__link" for="__nav_5_2" tabindex="0" aria-expanded="false">
          Zeppelin
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Zeppelin" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Zeppelin
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zeppelin-example-nyctaxi/" class="md-nav__link">
        NYC TAXI Benchmark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../zeppelin-example-face-data/" class="md-nav__link">
        KNN SEARCH
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" tabindex="0" aria-expanded="false">
          Build and deploy on Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Build and deploy on Kubernetes" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Build and deploy on Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../why-k8s/" class="md-nav__link">
        Why Kubernetes?
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../build-lightningdb-on-k8s/" class="md-nav__link">
        Build LightningDB(Admin Only)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../deploy-lightningdb-on-k8s/" class="md-nav__link">
        Deploy LightningDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-use-lightningdb-on-k8s/" class="md-nav__link">
        How to use LightningDB
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" tabindex="0" aria-expanded="false">
          Additional Resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Additional Resources" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Additional Resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../get-started-with-scratch/" class="md-nav__link">
        Manual Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-use-flashbase/" class="md-nav__link">
        Install with LightningDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manage-failover/" class="md-nav__link">
        Failover with LightningDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-scaleout/" class="md-nav__link">
        Scaleout with LightningDB
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#architecture-key-features" class="md-nav__link">
    Architecture &amp; key features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replication-failoverfailback" class="md-nav__link">
    Replication &amp; failover/failback
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<p>Tutorial</p>
<h1 id="1-about-lightning-db">1. About Lightning DB<a class="headerlink" href="#1-about-lightning-db" title="Permanent link">&para;</a></h1>
<h3 id="architecture-key-features">Architecture &amp; key features<a class="headerlink" href="#architecture-key-features" title="Permanent link">&para;</a></h3>
<p><img alt="" src="../images/tutorial-architecture.png" />
<img alt="" src="../images/tutorial-features.png" />
<img alt="" src="../images/tutorial-partitioning.png" />
<img alt="" src="../images/tutorial-query-accel.png" />
<img alt="" src="../images/tutorial-query-accel2.png" />
<img alt="" src="../images/tutorial-aggr-pushdown.png" /></p>
<h3 id="replication-failoverfailback">Replication &amp; failover/failback<a class="headerlink" href="#replication-failoverfailback" title="Permanent link">&para;</a></h3>
<p><img alt="" src="../images/tutorial-replication.png" />
<img alt="" src="../images/tutorial-failover.png" /></p>
<h1 id="2-ltcli">2. LTCLI<a class="headerlink" href="#2-ltcli" title="Permanent link">&para;</a></h1>
<p><a href="../install-ltcli/">Installation</a></p>
<p><a href="../command-line-interface/">Command Line</a></p>
<h1 id="3-ingestion">3. Ingestion<a class="headerlink" href="#3-ingestion" title="Permanent link">&para;</a></h1>
<h3 id="loadsh">load.sh<a class="headerlink" href="#loadsh" title="Permanent link">&para;</a></h3>
<p>'tsr2-tools'를 이용한 적재로 '-s' option으로 delimiter 설정 후 사용</p>
<pre><code>#!/bin/bash
if [ $# -ne 2 ];
then
    echo &quot;Usage: load_data.sh data-directory json-file&quot;
    echo &quot;(e.g.: load_data.sh ./data/split ./json/106.json)&quot;
    echo &quot;Warning: delimiter is '|'&quot;
    exit
fi
tsr2-tools insert java_options &quot;-Xms1g -Xmx32g&quot; -d $1 -s &quot;|&quot; -t $2 -p 40 -c 1 -i
</code></pre>
<ul>
<li>사용방법</li>
</ul>
<pre><code>[ltdb@d205 ~/tsr2-test]$ cat ./json/cell_nvkvs.json    // json file 작성.
{
&quot;endpoint&quot; : &quot;192.168.111.205:18600&quot;,
&quot;id&quot; :&quot;9999&quot;,
&quot;columns&quot; : 219,
&quot;partitions&quot; : [
216, 218, 3, 4
],
&quot;rowStore&quot; : true             // 적재하는 클러스터에서 'row-store-enabled'가 동일하게 'true'인지 확인 필요. 반대의 경우 둘다 'false'로 설정하면 됨.
}

[ltdb@d205 ~/tsr2-test]$ ls -alh ./test_data_one/                   // 적재할 데이터 확인. dir 및 file path 모두 가능함.
total 8.7M
drwxrwxr-x. 2 ltdb ltdb 50 2020-06-18 08:58:44 ./
drwxrwxr-x. 7 ltdb ltdb 84 2020-06-18 08:58:28 ../
-rw-rw-r--. 1 ltdb ltdb 8.7M 2020-06-18 08:58:44 ANALYSIS_CELL_ELG_20160711055950.dat

[ltdb@d205 ~/tsr2-test]$ load.sh                                        // 그냥 'load.sh'를 입력하면  args 정보가 표시됨.
Usage: load_data.sh data-directory json-file
(e.g.: load_data.sh ./data/split ./json/106.json)
Warning: delimiter is '|'
[ltdb@d205 ~/tsr2-test]$ load.sh ./test_data_one/ ./json/cell_nvkvs.json
/home/ltdb/tsr2-test/sbin/load.sh: line 9: tsr2-tools: command not found             // cluster 지정이 되지 않아 실행이 안되는 것으로 'cfc'를 사용하여 cluster 를 지정함

[ltdb@d205 ~/tsr2-test]$ cfc 6
[C:6][ltdb@d205 ~/tsr2-test]$ load.sh ./test_data_one/ ./json/cell_nvkvs.json       // 적재 시작.
SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding in [jar:file:/home/ltdb/tsr2/cluster_6/tsr2-assembly-1.0.0-SNAPSHOT/lib/logback-classic-1.2.3.jar!/org/slf4j/impl/StaticLoggerBinder.class]
</code></pre>
<h3 id="kafka-kafkacat-tsr2-kaetlyn">kafka &amp; kafkacat &amp; tsr2-kaetlyn<a class="headerlink" href="#kafka-kafkacat-tsr2-kaetlyn" title="Permanent link">&para;</a></h3>
<ul>
<li>zookeeper/kafka</li>
</ul>
<p>zookeeper 및 kafka broker 설치가 선행되어야 함 ==&gt; <a href="../kaetlyn/">Kafka&amp;Kaetlyn 설치</a> 참고</p>
<p>사용하는 topic은 크게 아래와 같이 3가지로 나누어짐</p>
<pre><code>1. 데이터 적재를 위한 topic
    - table간 dependency가 없도록 table별로 나눠서 적재 필요
2. error topic
    - 'tsr2-kaetlyn edit'을 통해 'KAFKA_ERROR_REPORT_TOPIC_NAME=topic-error' 로 설정
    - consuming 단계에서 적재 실패 시 error topic으로 에러 내용을 넣어서 적재 client가 확인할 수 있도록 함
3. result topic(optional)
    - consuming 후 적재 결과를 정의된 protocol에 맞게 적재 app에 전달할 수 있음
</code></pre>
<ul>
<li>kafka consumer</li>
</ul>
<p><a href="../kaetlyn/">Kafka&amp;Kaetlyn 설치</a>에서 가이드하고 있는 kaetlyn consumer를 사용하여 consumer를 설정.</p>
<p>'tsr2-kaetlyn edit'을 통해 consumer 설정이 필요함</p>
<p>기본적으로 '수정 필요'로 코멘트된 부분은 검토 및 수정이 필요함</p>
<pre><code>#!/bin/bash
###############################################################################
# Common variables
SPARK_CONF=${SPARK_CONF:-$SPARK_HOME/conf}
SPARK_BIN=${SPARK_BIN:-$SPARK_HOME/bin}
SPARK_SBIN=${SPARK_SBIN:-$SPARK_HOME/sbin}
SPARK_LOG=${SPARK_LOG:-$SPARK_HOME/logs}

SPARK_METRICS=${SPARK_CONF}/metrics.properties
SPARK_UI_PORT=${SPARK_UI_PORT:-14040}

KAFKA_SERVER=localhost:9092

###############################################################################
# Properties for Consumer
DRIVER_MEMORY=1g                               // 수정 필요

EXECUTOR_MEMORY=1g                               // 수정 필요
EXECUTORS=12                               // 수정 필요
EXECUTOR_CORES=12                               // 수정 필요

[[JSON_PATH]]=~/Flashbase/flashbase-benchmark/json/load_no_skew
JSON_PATH=/home/ltdb/tsr2-test/json                               // 수정 필요, json file 업데이트 시 kaetlyn 재시작 필요!
[[HIVE_METASTORE_URI]]=thrift://localhost:9083
HIVE_METASTORE_URI=''                               // 수정 필요
KAFKA_CONSUMER_GROUP_ID=nvkvs_redis_connector                               // 수정 필요
KAFKA_CONSUMING_TOPIC_LIST=nvkvs3                               // 수정 필요
JOB_GENERATION_PERIOD=1
MAX_RATE_PER_PARTITION=20000
KAFKA_ERROR_REPORT_TOPIC_NAME=topic-error
TEST_MODE=false
EXCUTOR_LOCALITY=false
</code></pre>
<ul>
<li>kafka producer
기본적으로 kafka producing은 아래와 같은 방법으로 할 수 있음</li>
</ul>
<pre><code>kafka-console-producer.sh --broker-list localhost:9092 --topic {topic name} &lt; {적재할 filename}
</code></pre>
<p>하지만, kaetlyn 적재를 위해서는 메시지에 아래 헤더 정보가 포함되어야 한다.</p>
<ul>
<li>TABLE_ID</li>
<li>SEPARATOR</li>
</ul>
<p>따라서 kafkacat이라는 tool을 통해 헤더 정보와 함께 producing을 해야 한다.(https://docs.confluent.io/3.3.0/app-development/kafkacat-usage.html# 참고)</p>
<pre><code>c++ compiler 설치

$yum install gcc-c++



$ git clone https://github.com/edenhill/librdkafka



$ cd librdkafka

$ ./configure

$ make

$ sudo make install



 /usr/local/lib 로 이동해주어 다음 명령어 실행한다.



$ git clone https://github.com/edenhill/kafkacat



$ cd kafkacat

$ ./configure

$ make

$ sudo make install



Lib 파일을 찾을 수 없다면

$ ldd kafkacat



다음의 파일을 만들고 아래를 추가 /etc/ld.so.conf.d/usrlocal.conf

Contents:

/usr/local/lib



저장 후 아래 명령어 실행

$ ldconfig -v



$kafkacat

Kafkacat에 대한 명령어가 나오면 성공
</code></pre>
<p>kafkacat이 정상 설치되었으면 아래와 같이 producing이 가능함</p>
<p>file 하나만 적재할 경우</p>
<pre><code>kafkacat -b localhost:9092 -t {topic name} -T -P -H TABLE_ID='{table id}' -H  SEPARATOR='|' -l {적재할 filename}
</code></pre>
<p>2. dir에 있는 모든 파일을 적재할 때에는 해당 dir로 이동한 후에,</p>
<pre><code>ls | xargs -n 1 kafkacat -q -b localhost:9092 -t {topic name} -P -H TABLE_ID='{table id}' -H  SEPARATOR='|' -l
</code></pre>
<p>** 기본적인 가이드는 <a href="../kaetlyn/">Kafka&amp;Kaetlyn 설치</a>에 있으므로 개념 이해를 위해서는 이 페이지를 참고하면 되지만 좀 더 편리하게 사용하기 위해 kafka-utils.sh를 제공하고 있어 운영 시에는  kafka-utils.sh를 사용하면 됨.</p>
<p>'kafka-utils.sh'는 각 클러스터별 sbin에 있으므로, 'cfc'로 cluster 설정 후 사용이 가능함.</p>
<pre><code>[C:6][ltdb@d205 ~]$ which kafka-utils.sh
~/tsr2/cluster_6/tsr2-assembly-1.0.0-SNAPSHOT/sbin/kafka-utils.sh
</code></pre>
<p>아래와 같이 'CONSUMER_GROUP_ID'가 지정되어 있지 않으면 실행이 되지 않으므로,</p>
<pre><code>[C:6][ltdb@d205 ~]$ kafka-utils.sh help
Please, set $CONSUMER_GROUP_ID first.
</code></pre>
<p>아래와 같이 'kafka-utils.sh'를 열어서 수정을 해야 함.</p>
<pre><code>#!/bin/bash

CONSUMER_GROUP_ID='nvkvs_redis_connector'  // 수정 필요
KAFKA_SERVER=localhost:9092
ZOOKEEPER_SERVER=localhost:2181...
</code></pre>
<p>'help'를 통해 가능한 커맨드를 확인할 수 있음.</p>
<pre><code>[C:6][ltdb@d205 ~/kafka/config]$ kafka-utils.sh help
kafka-utils.sh offset-check
kafka-utils.sh offset-monitor
kafka-utils.sh offset-earliest topic_name
kafka-utils.sh offset-latest topic_name
kafka-utils.sh offset-move topic_name 10000
kafka-utils.sh error-monitor error_topic_name
kafka-utils.sh consumer-list
kafka-utils.sh topic-check topic_name
kafka-utils.sh topic-create topic_name 10
kafka-utils.sh topic-delete topic_name
kafka-utils.sh topic-config-check topic_name
kafka-utils.sh topic-config-set topic_name config_name config_value
kafka-utils.sh topic-config-remove topic_name config_name
kafka-utils.sh topic-list
kafka-utils.sh message-earliest topic_name
kafka-utils.sh message-latest topic_name
</code></pre>
<p>command에 args가 필요한 경우, args없이 입력하면 아래와 같이 가이드 문구가 나옴.</p>
<pre><code>[C:6][ltdb@d205 ~/kafka/config]$ kafka-utils.sh offset-move 
Please, specify topic name &amp; the size of moving offset (ex) kafka-utils.sh offset-move my-topic 100
[C:6][ltdb@d205 ~/kafka/config]$ kafka-utils.sh topic-create
Please, specify topic name and its partition count. (ex) kafka-utils.sh topic-create topic-new 10
[C:6][ltdb@d205 ~/kafka/config]$
</code></pre>
<p>사용 예,</p>
<pre><code>[C:6][ltdb@d205 ~]$ kafka-utils.sh message-earliest nvkvs3
20160711055950|ELG|2635055200|34317|5|6091|1|25|0|11|0|100.0|0.0|0|2846|3|33|0|5|0|-1000|0.0|0.0|94932|1027|0|176|35.2|40|0|7818000000|109816071|10|0|6000000.0|164843|2.75|0|2592|6000000|0.04|1288488|1303|1338|0|530|1|88.33|0|721|67948|428|0|1|108|108.0|108|0|0.0|0|0|0|-1000|1|1|100.0|62|39.0|62.9|23.0|37.1|0|0|0|0|29|10|-7022851.0|59998.0|-117.05|-6865443.5|59998.0|-114.43|4|198060.0|59998.0|22.5|3.3|0|1|5.82|3|1.94||0|0|0|0|0|0|0|0|4|0|0|0|15|14|231|140|0|0|0|0|0|0|0|0|4|0|0|0|15|13|174|110|1|0|0|0|0|0|0|0|0|0|0|0|0|0|1|0|0|0|0|0|0|0|1|0|0|0|0|0|0|0|0|0|0.0|0.0|0.0|0.0|0.0|0.0|570.0|0.0|3.0|0.0|0.0|0.0|0.0|2.0|3.0|3.0|0.0|15.73|0.0|0.0|0.0|0.0|0.0|12.0|22.0|68.0|83.0|339.0|205.0|144.0|54.0|38.0|12.0|0.0|0.0|0.0|0.0|0.0|0.0|100.0|50.55|1:22,2:7|1.0|||||1:1,17:1,23:1|13.67|0|0|0.0|0.0|-1000||-1000||-1000|11|2|05
Processed a total of 1 messages


[C:6][ltdb@d205 ~]$ kafka-utils.sh topic-list
__consumer_offsets
nvkvs3
topic-error
topic_name


[C:6][ltdb@d205 ~]$ kafka-utils.sh topic-create ksh 18
Created topic ksh.


[C:6][ltdb@d205 ~]$ kafka-utils.sh topic-check  ksh
Topic:ksh   PartitionCount:18   ReplicationFactor:2 Configs:
    Topic: ksh  Partition: 0    Leader: 1   Replicas: 1,3   Isr: 1,3
    Topic: ksh  Partition: 1    Leader: 2   Replicas: 2,1   Isr: 2,1
    Topic: ksh  Partition: 2    Leader: 3   Replicas: 3,2   Isr: 3,2
    Topic: ksh  Partition: 3    Leader: 1   Replicas: 1,2   Isr: 1,2
    Topic: ksh  Partition: 4    Leader: 2   Replicas: 2,3   Isr: 2,3
    Topic: ksh  Partition: 5    Leader: 3   Replicas: 3,1   Isr: 3,1
    Topic: ksh  Partition: 6    Leader: 1   Replicas: 1,3   Isr: 1,3
    Topic: ksh  Partition: 7    Leader: 2   Replicas: 2,1   Isr: 2,1
    Topic: ksh  Partition: 8    Leader: 3   Replicas: 3,2   Isr: 3,2
    Topic: ksh  Partition: 9    Leader: 1   Replicas: 1,2   Isr: 1,2
    Topic: ksh  Partition: 10   Leader: 2   Replicas: 2,3   Isr: 2,3
    Topic: ksh  Partition: 11   Leader: 3   Replicas: 3,1   Isr: 3,1
    Topic: ksh  Partition: 12   Leader: 1   Replicas: 1,3   Isr: 1,3
    Topic: ksh  Partition: 13   Leader: 2   Replicas: 2,1   Isr: 2,1
    Topic: ksh  Partition: 14   Leader: 3   Replicas: 3,2   Isr: 3,2
    Topic: ksh  Partition: 15   Leader: 1   Replicas: 1,2   Isr: 1,2
    Topic: ksh  Partition: 16   Leader: 2   Replicas: 2,3   Isr: 2,3
    Topic: ksh  Partition: 17   Leader: 3   Replicas: 3,1   Isr: 3,1
</code></pre>
<h1 id="4-query">4. Query<a class="headerlink" href="#4-query" title="Permanent link">&para;</a></h1>
<h3 id="thriftserver">thriftserver<a class="headerlink" href="#thriftserver" title="Permanent link">&para;</a></h3>
<p>thriftserver를 사용하여 질의를 수행할 수 있으며, hive-metastore를 사용해서 메타정보를 관리할 수 있습니다.</p>
<p>각 cluster에 thriftserver 가 있으며, 특정 클러스터에서 띄울 수 있습니다.</p>
<pre><code>&gt; cfc 6
&gt; which thriftserver
~/tsr2/cluster_6/tsr2-assembly-1.0.0-SNAPSHOT/sbin/thriftserver
</code></pre>
<p>실행 전, 'thriftserver edit'을 통해 설정값을 변경합니다.</p>
<pre><code>#!/bin/bash
###############################################################################
# Common variables
SPARK_CONF=${SPARK_CONF:-$SPARK_HOME/conf}
SPARK_BIN=${SPARK_BIN:-$SPARK_HOME/bin}
SPARK_SBIN=${SPARK_SBIN:-$SPARK_HOME/sbin}
SPARK_LOG=${SPARK_LOG:-$SPARK_HOME/logs}

SPARK_METRICS=${SPARK_CONF}/metrics.properties
SPARK_UI_PORT=${SPARK_UI_PORT:-14050}
EXECUTERS=12       // 수정 필요
EXECUTER_CORES=32     // 수정필요

HIVE_METASTORE_URL=''
HIVE_HOST=${HIVE_HOST:-localhost}
HIVE_PORT=${HIVE_PORT:-13000}

COMMON_CLASSPATH=$(find $SR2_LIB -name 'tsr2*' -o -name 'spark-r2*' -o -name '*jedis*' -o -name 'commons*' -o -name 'jdeferred*' \
-o -name 'geospark*' -o -name 'gt-*' | tr '\n' ':')

###############################################################################
# Driver
DRIVER_MEMORY=6g      // 수정 필요
DRIVER_CLASSPATH=$COMMON_CLASSPATH

###############################################################################
# Execute
EXECUTOR_MEMORY=2g      // 수정 필요
EXECUTOR_CLASSPATH=$COMMON_CLASSPATH

###############################################################################
# Thrift Server logs
EVENT_LOG_ENABLED=false
EVENT_LOG_DIR=/nvdrive0/thriftserver-event-logs
EVENT_LOG_ROLLING_DIR=/nvdrive0/thriftserver-event-logs-rolling
EVENT_LOG_SAVE_MIN=60
EXTRACTED_EVENT_LOG_SAVE_DAY=5
SPARK_LOG_SAVE_MIN=2000
##############

</code></pre>
<ul>
<li>start 방법</li>
</ul>
<pre><code>thriftserver start
</code></pre>
<ul>
<li>stop 방법</li>
</ul>
<pre><code>thriftserver stop
</code></pre>
<ul>
<li>yarn application 확인</li>
</ul>
<pre><code>&gt; yarn application -list
20/06/25 17:04:35 INFO client.RMProxy: Connecting to ResourceManager at d205/192.168.111.205:18032
Total number of applications (application-types: [] and states: [SUBMITTED, ACCEPTED, RUNNING]):1
                Application-Id      Application-Name        Application-Type          User       Queue               State         Final-State         Progress                        Tracking-URL
application_1592880218288_0002   ThriftServer_d205_6                   SPARK          ltdb     default             RUNNING           UNDEFINED              10%                   http://d205:14050
</code></pre>
<ul>
<li>table properties 확인</li>
</ul>
<pre><code>0: jdbc:hive2://0.0.0.0:13000&gt; show tables;
+-----------+-----------------------------------------------+--------------+--+
| database | tableName | isTemporary |
+-----------+-----------------------------------------------+--------------+--+
| default | aua_adong_cd | false |
| default | aua_aom_log | false |
| default | aua_cell_by10sec_sum | false |
| default | aua_cell_by5min_sum | false |
| default | aua_cell_cfg_inf | false |
| default | aua_enb_nsn_ho_log | false |
| default | aua_enb_nsn_rrc_log | false |
| default | aua_enb_ss_csl_log | false |
| default | aua_ra_cscore_area_5min_sum | false |
| default | aua_ue_rf_sum | false |
| | aua_aom_log_6fbb17bb9718a46306ec7a9766464813 | true |
+-----------+-----------------------------------------------+--------------+--+
11 rows selected (0.045 seconds)

0: jdbc:hive2://0.0.0.0:13000&gt; show tblproperties aua_ue_rf_sum;
+---------------------------------------------+-------------------------------------------------------------------------------------------------+--+
| key | value |
+---------------------------------------------+-------------------------------------------------------------------------------------------------+--+
| transient_lastDdlTime | 1581872791 |
| fb.load.kafka.bootstrap.servers | 90.90.200.182:9092,90.90.200.183:9092,90.90.200.184:9092,90.90.200.185:9092,90.90.200.186:9092 |
| fb.transformation.column.add.IMSI_KEY | ${IMSI_NO}.length() &gt;= 2 &amp;&amp; ${IMSI_NO}.substring(0, 2).equals(&quot;T1&quot;) ? &quot;T1&quot; : &quot;O&quot; |
| fb.transformation.column.add.IMSI_HASH_KEY | fnvHash(${IMSI_NO}, 5) |
| fb.load.kafka.producer.compression.type | zstd |
| fb.transformation.column.add.EVENT_TIME | ${EVT_DTM}.length() &lt; 12 ? &quot;000000000000&quot; : ${EVT_DTM}.substring(0, 11).concat(&quot;0&quot;) |
| fb.load.kafka.topic.name | topic-tango-dev |
| Comment | 단말별 분석 결과 |
| fb.load.kafka.producer.max.request.size | 1048576 |
+---------------------------------------------+-------------------------------------------------------------------------------------------------+--+
9 rows selected (0.1 seconds)
0: jdbc:hive2://0.0.0.0:13000&gt;

0: jdbc:hive2://0.0.0.0:13000&gt; show create table aua_ue_rf_sum;
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--+
| createtab_stmt |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--+
| CREATE TABLE `aua_ue_rf_sum` (`EVT_DTM` STRING, `VEND_ID` STRING, `ADONG_CD` STRING, `ENB_ID` STRING, `CELL_ID` STRING, `ENB_UE_S1AP_ID` STRING, `MME_UE_S1AP_ID` STRING, `IMSI_NO` STRING, `EVT_ID` STRING, `CALL_RESULT_CODE` STRING, `CALL_RESULT_MSG` STRING, `FREQ_TYP_CD` STRING, `CQI` STRING, `TA` STRING, `RSRP` STRING, `RSRQ` STRING, `DL_PACKET_LOSS_SUCC_CNT` STRING, `DL_PACKET_LOSS_LOST_CNT` STRING, `DL_PACKET_LOSS_RATE` STRING, `SINR_PUSCH` STRING, `SINR_PUCCH` STRING, `UE_TX_POWER` STRING, `PHR` STRING, `UL_PACKET_LOSS_SUCC_CNT` STRING, `UL_PACKET_LOSS_LOST_CNT` STRING, `UL_PACKET_LOSS_RATE` STRING, `RRC_LATENCY` STRING, `HO_LATENCY` STRING, `RRE_LATENCY` STRING, `DL_NO_RTP` STRING, `UL_NO_RTP` STRING, `ERAB_LATENCY` STRING, `RRC_ERAB_LATENCY` STRING, `EVENT_TIME` STRING, `IMSI_KEY` STRING, `IMSI_HASH_KEY` STRING, `UE_ENDC_STAGE` STRING)
USING r2
OPTIONS (
`query_result_partition_cnt_limit` '2000000',
`query_response_timeout` '1200000',
`query_result_task_row_cnt_limit` '1000000',
`host` '90.90.200.187',
`serialization.format` '1',
`query_result_total_row_cnt_limit` '2147483647',
`group_size` '10',
`port` '18600',
`mode` 'nvkvs',
`partitions` 'EVENT_TIME ENB_ID IMSI_KEY IMSI_HASH_KEY',
`second_filter_enabled` 'no',
`table` '6010'
)
|
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--+
1 row selected (0.027 seconds)

0: jdbc:hive2://0.0.0.0:13000&gt; select event_time, enb_id, vend_id from aua_ue_rf_sum limit 3;
Error: com.skt.spark.r2.exception.UnsupportedQueryTypeException: at least one partition column should be included in where predicates; caused by 6010 table. You must check to exist partition column(s) of this table or mistype condition of partition column(s) in where clause. : EVENT_TIME,ENB_ID,IMSI_KEY,IMSI_HASH_KEY (state=,code=0)

0: jdbc:hive2://0.0.0.0:13000&gt; select event_time, enb_id, vend_id from aua_ue_rf_sum where event_time='202006250000' limit 3;
+---------------+---------------------------+----------+--+
| event_time | enb_id | vend_id |
+---------------+---------------------------+----------+--+
| 202006250000 | +F/Ca+X5UZSATNF0zTR9kA== | ELG |
| 202006250000 | +F/Ca+X5UZSATNF0zTR9kA== | ELG |
| 202006250000 | +F/Ca+X5UZSATNF0zTR9kA== | ELG |
+---------------+---------------------------+----------+--+
3 rows selected (0.149 seconds)
0: jdbc:hive2://0.0.0.0:13000&gt;
</code></pre>
<h1 id="5-zeppelin">5. Zeppelin<a class="headerlink" href="#5-zeppelin" title="Permanent link">&para;</a></h1>
<p>Zeppelin 튜토리얼을 진행하기 전, <a href="https://docs.lightningdb.io/try-with-zeppelin/#1-setting-for-zeppelin">Zeppelin에 Lightning DB 관련 Jar 파일들이 추가하도록 설정</a>하였는지 확인해주세요.</p>
<p>아래와 같이 <a href="https://docs.lightningdb.io/scripts/tutorial_ko.json">튜토리얼 노트 파일</a>을 내려받거나 아래 URL을 입력하여 Zeppelin에서 불러옵니다.</p>
<ul>
<li>튜토리얼 노트 링크: https://docs.lightningdb.io/scripts/tutorial_ko.json</li>
</ul>
<p><img alt="Import Zeppelin note" src="https://docs.lightningdb.io/images/import_notebook.gif" /></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      All right reserved, <a href='https://lightningdb.io'>Lightning DB Team</a>.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": 0.1}</script>
    
    
      <script src="../assets/javascripts/bundle.51d95adb.min.js"></script>
      
        <script src="../search/main.js"></script>
      
    
  </body>
</html>